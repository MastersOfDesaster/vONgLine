version: '3'

services:

  frontend:
    build: frontend/
    container_name: vongline_frontend
    command: certbot certonly --authenticator standalone -m -q benjamin.albrecht@hs-bochum.de --agree-tos --rsa-key-size 4096 -d vongpiler.de -d www.vongpiler.de
    ports:
      - 80:80
      - 443:433
    volumes:
    - cert:/etc/letsencrypt/live

  backend:
    build: backend/
    container_name: vongline_backend
    privileged: true
    ports:
      - "8443:8443"
    volumes:
      - cert:/etc/letsencrypt/live:ro
      - vsh:/app/tmp/vsh
      - /var/run/docker.sock:/var/run/docker.sock

  compiler:
    build: compiler/
    container_name: vongline_compiler
    volumes:
      - /tmp/vongline/vch:/app/tmp/vch
      - vsh:/app/tmp/vsh:ro
    tty: true

  runtime:
    build: runtime/

volumes:
  vsh:
  cert:
